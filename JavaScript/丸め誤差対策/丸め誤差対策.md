# 丸め誤差対策

## 丸め誤差が発生する原因

浮動小数点数の計算には IEEE754(浮動小数点数算術標準)が使われています。

↓

浮動小数点数が 2 進数で表せない数の場合は近似値で表されることになり、誤差が生じます。

## 丸め誤差の例

```js
console.log(10.12 * 10000);
// 101199.99999999999
```

```js
console.log(0.3 - 0.2);
// 0.09999999999999998
```

```js
console.log(0.1 + 0.2);
// 10.320000000000002
```

```js
let x = 0.14 * 100;
console.log(x);
// 14.000000000000002

let y = 0.28 * 100;
console.log(y);
// 28.000000000000004

console.log((x + y) / 100);
// 28.000000000000004
```

```js
value1 = 20.42;
value2 = 10.1;

result = (value1 * 100 - value2 * 100) / 100;
// 10.320000000000002
```

## 丸め誤差の対応

### 対策 1 ライブラリを導入する

decimal.js、big.js を利用するようにする

big.js のサンプル

```js
// 計算の軸となる数値
let numA = new Big(0.1);
let numB = 0.2;

// 計算の軸となるnumAに対して、numBを加算する
let ans = numA.plus(numB);

// 出力結果：0.3
console.log(ans.toNumber());
```

### 対策 2 値を整数にして演算して元に戻す

演算する際は Math.round()で整数にする必要があります。
Math.round()を忘れると丸め誤差のサンプルのような結果になります。

```js
const x = 0.14 * 100;
const y = 0.28 * 100;

console.log((Math.round(x) + Math.round(y)) / 100);
```
